---
title: "Descrição dos compradores e fornecedores de merenda"
subtitle: "Merenda Escolar"
author: "Laboratório Analytics"
layout: post
published: false
comments: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  warning = FALSE,
  message = FALSE,
  screenshot.force = FALSE,
  fig.cap = '',
  fig.align = 'center',
  fig.width = 10)

options(scipen = 999)
```

```{r adicao de bibliotecas}
library(ggthemes)
library(corrplot)
library(ggplot2)
library(plotly)

library(RColorBrewer)
library(scales)

library(tidyr)
library(plyr)
library(dplyr)

library(tm)
library(wordcloud)
library(stringr)

library(maps)   # mapas simples, eixos, escala, cidades
library(ggmap)  # Gmaps, OSM + mapas baseados em ggplot2
library(rgdal)
library(leaflet)
library(htmltools)

library(knitr)
library(methods)

library(rsagrespb)

library(lubridate)
```

```{r}
utils = src_mysql('utils', group='ministerio-publico', password=NULL)
municipios = tbl(utils, 'municipio') %>%
  collect()

sagres = src_mysql('SAGRES_MUNICIPAL', group='ministerio-publico', password=NULL)

empenhos_merenda <- get_empenhos_filtrados(dbcon = sagres, cd_funcao = 12, cd_subfuncao = 306, cd_subelemento = "02") %>%
  collect(n = Inf) %>%
  mutate(cd_UGestora_copy = cd_UGestora) %>%
  separate(cd_UGestora_copy, c('cd_UnGestora', 'cd_Municipio'), -4) %>%
  left_join(municipios %>% select(cd_Municipio, de_Municipio), 'cd_Municipio') %>%
  mutate(cd_Municipio = as.integer(cd_Municipio)) %>%
  select(-cd_UnGestora)

tipos_licitacao = tbl(sagres, 'Tipo_Modalidade_Licitacao') %>%
  collect() %>%
  mutate(de_TipoLicitacao = as.character(de_TipoLicitacao))

licitacoes <- tbl(sagres, 'Licitacao') %>%
  filter(year(dt_Homologacao) >= 2003 & year(dt_Homologacao) <= 2016) %>%
  collect(n = Inf) %>%
  mutate(dt_Homologacao = ymd_hms(dt_Homologacao)) %>%
  left_join(tipos_licitacao, by = 'tp_Licitacao')


## Adicionando código do município a tabela de licitações
licitacoes <- licitacoes %>%
  mutate(cd_UGestora_copy = cd_UGestora) %>%
  separate(cd_UGestora_copy, c('cd_UnGestora', 'cd_Municipio'), -4) %>%
  left_join(municipios %>% select(cd_Municipio, de_Municipio), 'cd_Municipio') %>%
  select(-cd_UnGestora)

empenhos_merenda_group <- empenhos_merenda %>%
  group_by(cd_UGestora, nu_Licitacao, tp_Licitacao) %>%
  summarise(valor_merenda = sum(vl_Empenho))

empenhos <- tbl(sagres, 'Empenhos') %>%
  select(c(cd_UGestora, dt_Ano, cd_UnidOrcamentaria, nu_Empenho, vl_Empenho, dt_Empenho)) %>%
  mutate(cd_UGestora_copy = cd_UGestora) %>%
  collect(n = Inf) %>%
  mutate(dt_Empenho = ymd_hms(dt_Empenho)) %>%
  filter(year(dt_Empenho) >= 2003 & year(dt_Empenho) <= 2016) %>%
  separate(cd_UGestora_copy, c('cd_UnGestora', 'cd_Municipio'), -4) %>%
  left_join(municipios %>% select(cd_Municipio, de_Municipio), 'cd_Municipio') %>%
  select(-cd_UnGestora) 

licitacoes_merenda <- licitacoes %>% 
  right_join(empenhos_merenda_group, by = c('cd_UGestora', 'nu_Licitacao', 'tp_Licitacao'))


```

Alguma vez você já se perguntou como os gestores de seu município empregam o dinheiro que recebem? 
Se sua resposta para a pergunta anterior foi sim, é possível que você tenha sentido dificuldades para reunir informações relevantes, que ajudassem a chegar numa conclusão bem fundamentada, ou que tenha até mesmo coletado tais informações, mas acabou por não saber o que fazer com elas. Problemas como esses são bem comuns ao se lidar com dados relacionados ao orçamento dos municípios e, muitas vezes, afastam o cidadão de seu papel de fiscalizador das ações do estado. Tentando trazer o cidadão de volta a esse papel, foi elaborado esse relatório, onde esperamos facilitar o entendimento sobre os gastos dos municípios da Paraíba, até mesmo se você tenha respondido não à questão anterior :)  

Antes de iniciarmos, alguns pontos importantes precisam ser esclarecidos. Uma etapa muito importante no processo de gastos públicos é a licitação. É por meio dela que a administração pública contrata serviços, realiza obras e compra produtos, por exemplo. Ela é o ponto de inicial de quase todo processo de investimento de receitas públicas, salvo algumas exceções onde podem ser dispensadas ou não são aplicáveis. Para obter mais detalhes sobre tais exceções, é possível acessar as leis [8666/1993](http://www.planalto.gov.br/ccivil_03/leis/L8666cons.htm) e [10520/2002](http://www.planalto.gov.br/ccivil_03/leis/2002/l10520.htm), onde estão definidas as regras para o processo licitatório.  

Os dados utilizados nesse relatório foram obtidos a partir da plataforma [SAGRES](https://sagres.tce.pb.gov.br/) do [Tribunal de Contas do Estado da Paraíba](https://portal.tce.pb.gov.br/) e a parcela deles utilizada compreende informações sobre o processo de gastos públicos dos municípios do estado entre os anos de 2003 e 2016. Uma das principais limitações encontradas ao se trabalhar com os dados dessa fonte surge da possibilidade das prefeituras contratarem vários serviços ou adquirirem produtos com finalidades distintas em um único processo licitatório. Os itens que compreendem essas licitações não estão descritos nos dados obtidos, o que dificulta bastante a obtenção de informações como o valor, total ou fornecedor de cada um deles. 

## Panorama
### Qual o número de licitações realizadas em cada ano do período analisado?
Uma boa forma de obtermos uma visão geral de nossos dados, é verificar quantas licitações foram realizadas a cada ano durante o período analisado. Fazendo isso, uma coisa bastante interessante pode ser vista: há três 'saltos' no total de licitações realizadas. O primeiro desses saltos ocorre em 2005, quando há um aumento de 66% no número de licitações realizadas. Em seguida, há um novo salto em 2009, sendo de 33% o aumento no número de licitações. O último salto ocorre em 2013 e o aumento é de 52%. O que esses anos teriam em comum? Os três marcam o início dos mandatos municipais.


```{r}
licitacoes %>%
  plot_ly() %>%
    add_histogram(x = ~as.factor(year(dt_Homologacao))) %>%
    layout(title = "Total de licitações por ano",
           yaxis = list(title = 'Número total de licitações', hoverformat= '.0f', fixedrange = TRUE),
           xaxis = list(title = 'Ano')) 
```


### 
Outra coisa interessante de ser analisada é o padrão de licitação dos municípios. Por meio disso, podemos descobrir quais são os municípios que mais realizam licitações de merenda e quantos itens, em média, há nas licitações desses municípios.
Feita essa análise, descobrimos que dos cinco municípios que mais realizam licitações, quatro também estão presentes na lista dos mais populosos do estado. São eles: João Pessoa, Campina Grande, Santa Rita e Patos. A exceção aqui fica por conta do município de Pombal, que não está entre os quinze municípios mais populosos do estado e é o quinto maior realizador de licitações.


```{r}
cinco_mais <- licitacoes %>%
  group_by(de_Municipio) %>%
  summarise(total_licitacoes = n()) %>%
  arrange(desc(total_licitacoes)) %>%
  head(5) %>%
  select(de_Municipio)

licitacoes %>%
  inner_join(cinco_mais, by = "de_Municipio") %>%
  group_by(de_Municipio) %>%
  summarise(total_licitacoes = n()) %>%
  plot_ly() %>%
    add_bars(x = ~de_Municipio, y=~total_licitacoes) %>%
    layout(title = "Municipios que mais licitaram",
           yaxis = list(title = 'Número total de licitações', hoverformat= '.0f', fixedrange = TRUE),
           xaxis = list(title = 'Município')) 
```


Aprofundando essa mesma ideia, buscamos verificar como o total de licitações realizados nesses municípios variou durante os anos observados. Dessa vez, chama atenção o caso de João Pessoa, que apresentou uma queda drástica no número de licitações realizadas entre os anos de 2013 e 2016. 

```{r}
licitacoes %>%
  inner_join(cinco_mais, by = "de_Municipio") %>%
  mutate(dt_Ano_Homologacao = as.numeric(year(dt_Homologacao))) %>%
  group_by(de_Municipio, dt_Ano_Homologacao) %>%
  summarise(total_por_ano = n()) %>%
  plot_ly() %>%
    add_trace(x=~dt_Ano_Homologacao, y=~total_por_ano, color=~de_Municipio, type = "scatter", mode="lines+markers") %>%
    layout(title = "Total anual de licitações nos 5 municípios que mais licitaram",
           yaxis = list(title = 'Número total de licitações', hoverformat= '.0f', fixedrange = TRUE),
           xaxis = list(title = 'Ano')) 
```


Aqui cabe uma explicação: Uma diminuição no total de licitações realizadas, não necessariamente implica que houveram menos compras ou contratações. Precisamos lembrar que uma única licitação pode compreender vários itens, e, por isso, análise do total de licitações serve principalmente como uma verificação dos hábitos licitatórios de cada prefeitura. A verificação do total de materiais adquiridos e serviços contratados pode ser *aproximada* utilizando as diferentes compensações financeiras geradas pela licitação, representadas geralmente na forma de **empenhos**. Esse é o próximo passo que devemos tomar.


```{r}
empenhos %>%
  inner_join(cinco_mais, by = "de_Municipio") %>%
  mutate(dt_Ano) %>%
  group_by(de_Municipio, dt_Ano) %>%
  summarise(total_por_ano = n()) %>%
  plot_ly() %>%
     add_trace(x=~dt_Ano, y=~total_por_ano, color=~de_Municipio, type = "scatter", mode="lines+markers") %>%
    layout(title = "Total anual de empenhos nos 5 municípios que mais licitaram",
           yaxis = list(title = 'Número total de empenhos', hoverformat= '.0f', fixedrange = TRUE),
           xaxis = list(title = 'Ano')) 
```




## 2 - Análise de Licitações
Agora que entendemos melhor nossos dados e variáveis, podemos ir mais a fundo! Escolhemos trabalhar com dados relacionados com a __merenda escolar dos municípios da paraíba entre 2012 e 2016__.  
Você sabe quanto o seu município gastou com merenda nos últimos anos? Será que ele está dentro da média da Paraíba? Quantas licitações são feitas para alimentação escolar? Quem gasta mais? Quem gasta menos? Essas e muitas outras perguntas podem ser respondidas pela análise abaixo. 

### Quantas licitações de merenda são feitas por ano?

```{r}
licitacoes_merenda <- licitacoes_merenda %>%
  filter(year(dt_Homologacao) >= 2012 & year(dt_Homologacao) <= 2016)

plot_ly(data = licitacoes 
        %>% filter(year(dt_Homologacao) >= 2012 & year(dt_Homologacao) <= 2016)) %>%
  add_histogram(x = ~as.factor(year(dt_Homologacao)), name = "Outras as licitações") %>%
  add_histogram(data = licitacoes_merenda, ~as.factor(year(dt_Homologacao)), name = "Merenda Escolar") %>%
  layout(title = "Total de licitações de merenda em relação ao total de licitações",
         yaxis = list(title = 'Número de licitações', hoverformat= '.0f'),
         xaxis = list(title = 'Ano'),
         barmode = 'overlay')
```

Temos uma grande quantidade de licitações, envolvendo os mais diversos itens, mas neste trabalho estamos interessados nos dados que dizem respeito a merenda escolar, então a partir daqui nosso foco será sobre este subconjunto de informação, assim os dados que vamos estudar estão dispostos nos gráfico abaixo.

```{r}
plot_ly(data = licitacoes_merenda, x = ~as.factor(year(dt_Homologacao)), type='histogram') %>%
  layout(
    xaxis = list(title = "Ano"),
    yaxis = list(title = "Número total de licitações"),
    title = "Total de licitações de merenda por ano")
```
  
    
Podemos perceber que houve um "salto" no número de licitações entre 2012 e 2013, o que indica que os municípios passaram fazer mais licitações envolvendo merenda, esse salto acontece também nos dados gerais de licitação e já foi analisado neste mesmo relatório.
 
### Quem faz mais licitações de merenda?

```{r results='hide'}
mapa_paraiba <- readOGR("../dados/mapa_paraiba_ibge/Municipios.shp")

# Atualizando nome de municípios que mudaram de nome nos últimos anos
levels_mapa = levels(mapa_paraiba@data$Nome_Munic)
levels_mapa[51] = "Tacima"
levels_mapa[200] = "São Vicente do Seridó"
levels_mapa[173] = "Joca Claudino"
levels_mapa[156] = "Quixaba"
levels(mapa_paraiba@data$Nome_Munic) = levels_mapa

# Join entre a tabela de licitações e a lista de municípios do mapa
mapa_paraiba@data$Nome_Munic = as.character(mapa_paraiba@data$Nome_Munic)
paraiba = licitacoes_merenda %>% 
  inner_join(mapa_paraiba@data, c('de_Municipio' = 'Nome_Munic'))

paraiba_sumarizado = paraiba %>%
  group_by(de_Municipio) %>%
  summarize(total = n(),
            valor_medio_emp = mean(valor_merenda),
            valor_total_emp = sum(valor_merenda),
            total_num = n(),
            valor_total_emp_num = sum(valor_merenda))

# Dividindo em faixas
paraiba_sumarizado$total = cut(paraiba_sumarizado$total,
                                breaks = c(1,5,7,10,15,25,50, 120),
                               labels = c("de 1 a 5", "de 5 a 7", "de 7 a 10", "de 10 a 15", "de 15 a 25", "de 25 a 50", "Acima de 50"),
                                include.lowest = F)

paraiba_sumarizado$valor_total_emp <- cut(paraiba_sumarizado$valor_total_emp,
                                         breaks = c(1, 250000, 500000, 750000, 1000000, 2000000, 4000000,1000000000),
                                         labels = c("De 1 a 250", "De 250 a 500", "De 500 a 750", "De 750 a 1000", "De 1000 a 2000", "De 2000 a 4000", "Acima de 4000"))

levels_mapa = mapa_paraiba@data$Nome_Munic
paraiba_municipios = data.frame(levels_mapa, mapa_paraiba@data$OBJECTID)

# Associando cada municipio do mapa ao municipio correspondente no dataframe de sumarização
paraiba_municipios = paraiba_municipios %>% left_join(paraiba_sumarizado, c('levels_mapa' = 'de_Municipio'))

```

```{r}
colors = brewer.pal(6,"YlOrRd")

# A variável Y recebe os valores em ordem que devem apontar para cada municipio
mapa_paraiba@data$Y <- paraiba_municipios$total
mapa_paraiba@data$X <- paraiba_municipios$total_num
colors = colorFactor('OrRd', mapa_paraiba@data$Y)

leaflet(data = mapa_paraiba) %>%
  addProviderTiles(providers$Esri.WorldGrayCanvas) %>%
  addPolygons(opacity = 0.5,
              weight = 1,
              fillColor = colors(mapa_paraiba@data$Y),
              color = 'black',
              label = paste(mapa_paraiba@data$Nome_Munic),
              popup = paste("Município: ", str_to_upper(mapa_paraiba@data$Nome_Munic), "</br>",
                            "Número de Licitações: ", mapa_paraiba@data$X),
              fillOpacity = 1) %>%
  addLegend(position = "bottomright", pal = colors, values = mapa_paraiba@data$Y,
            title = "Licitações por município",
            opacity = 1, na.label = "0"
  )
```

Os municípios que mais fizeram licitações envolevendo merenda foram:

```{r}

kable(
  x = head(arrange(select(paraiba_sumarizado, c(de_Municipio, total_num)), desc(total_num)), 5),
  col.names = c('Município', 'Número de Licitações'),
  align = c('c'))
```

Os que menos licitaram:

```{r}
kable(
  x = tail(arrange(select(paraiba_sumarizado, c(de_Municipio, total_num)), desc(total_num)), 5),
  col.names = c('Município', 'Número de Licitações'),
  align = c('c'))
```

 
### Quem gasta mais com merenda?

Vamos analisar os municípios que mais gastam recursos com merenda escolar.
Para isso consideramos como gasto com merenda escolar a soma de tudo que foi _empenhado_ no período em estudo que diz respeito a merenda escolar. 

```{r}
colors = brewer.pal(7,"YlOrRd")
mapa_paraiba@data$Y <- paraiba_municipios$valor_total_emp
mapa_paraiba@data$X <- paraiba_municipios$valor_total_emp_num
colors = colorFactor('OrRd', mapa_paraiba@data$Y)

leaflet(data = mapa_paraiba) %>%
  addProviderTiles(providers$Esri.WorldGrayCanvas) %>%
  addPolygons(opacity = 0.5,
              weight = 1,
              fillColor = colors(mapa_paraiba@data$Y),
              color = 'black',
              label = mapa_paraiba@data$Nome_Munic,
              popup = paste("Município: ", str_to_upper(mapa_paraiba@data$Nome_Munic), "</br>",
                            "Valor empenhado para merenda: ", mapa_paraiba@data$X),
              fillOpacity = 1) %>%
  addLegend(position = "bottomright", pal = colors, values = mapa_paraiba@data$Y,
            title = "Valor empenhos de merenda (em milhares)",
            opacity = 1, na.label = "0"
  )

```
  
É importante observar que a média geral de gastos com merenda na paraíba é de `r round(mean(paraiba_sumarizado$valor_total_emp_num), 2)` mas a mediana é de `r round(median(paraiba_sumarizado$valor_total_emp_num), 2)` o que significa que alguns municípios gastam muito mais que os outros e isto está deixando a média tão alta.

Os 10 municípios que mais gastam são:

```{r}
top10 <- head(arrange(select(paraiba_sumarizado, c(de_Municipio, valor_total_emp_num)), desc(valor_total_emp_num)), 10)
kable(
  x = top10, 
  col.names = c('Município', 'Valor total dos empenhos de merenda'),
  align = c('c'))

perc_top10 <- sum(top10$valor_total_emp_num) / sum(paraiba_sumarizado$valor_total_emp_num)
```

Juntos, eles respresentam `r round(perc_top10*100, 1)`% do valor gasto por todos os municípios. Logo, os outros 213 municípios gastam a outra metade do dinheiro.  
Como é de se esperar João Pessoa e Campina Grande são as que mais gastam, já que elas são as cidades com mais habitantes no estado. As demais cidades que mais gastam estão todas entre as 20 cidades com mais habitantes do estado (de acordo com a projeção do IBGE para 2016).  

### 2.7 - Qual o comportamento da média e da mediana do valor das licitações de merenda ao longo dos anos (2011-2015)?

```{r}
lic_merenda_sum <-licitacoes_merenda %>%
  group_by(year(dt_Homologacao)) %>%
  summarise(mean_vl = mean(valor_merenda),
            median_vl = median(valor_merenda))

colnames(lic_merenda_sum)[1] <- "ano"

plot_ly(data = lic_merenda_sum, x = ~as.factor(ano)) %>%
  add_trace(y = ~mean_vl/1000, type = 'scatter', name = 'Média', mode = 'lines+markers') %>%
  add_trace(y = ~median_vl/1000, type = 'scatter', name = 'Mediana', mode = 'lines+markers') %>%
  layout(title = "Valor médio e mediano das licitações de merenda por ano",
         yaxis = list(title = 'Valor da licitação (em milhares de reais)', hoverformat= '.2f'),
         xaxis = list(title = 'Ano'))
```

```{r}
kable(
  x = head(arrange(select(subset(licitacoes_merenda, year(licitacoes_merenda$dt_Homologacao) == 2014),
                          c(de_Municipio, valor_merenda)), desc(valor_merenda)), 5),
  col.names = c('Município', 'Valor da empenhado para merenda (R$)'),
  align = c('c'))
```


### 2.8 - Em que período do ano ocorrem mais licitações de merenda?

```{r}
plot_ly(data = licitacoes_merenda) %>%
  add_histogram(x = ~month(dt_Homologacao)) %>%
  layout(title = 'Total de licitações por mês entre os anos 2012 e 2016',
         yaxis = list(title = 'Total', hoverformat= '.0f'),
         xaxis = list(title = 'Mês', dtick = 1))
```

### 2.9 - Em geral, as licitaçoes mais caras estão concentradas em alguma época do ano?
```{r}
mediana_geral = median(licitacoes_merenda$valor_merenda)

plot_ly(data = (licitacoes_merenda %>%
                  mutate(mes = month(dt_Homologacao)) %>%
                  group_by(mes) %>%
                  summarize(mediana = median(valor_merenda)))) %>%
  add_trace(x = ~as.factor(mes), y = ~mediana, type = 'scatter', mode = 'lines+markers',
            name = 'Mediana mensal',
            text = ~paste('Mês: ', mes, '', 'Mediana: R$', mediana),
            hoverinfo = 'text') %>%
  add_trace(x = ~as.factor(mes), y = mediana_geral, type = 'scatter', mode = 'lines',
            name = 'Mediana geral',
            text = ~paste('Mediana Geral: R$', mediana_geral),
            hoverinfo = 'text',
            line = list(dash = "dash"),
            opacity = 0.75) %>%
  layout(
    title = 'Valor mediano de licitações por mês entre os anos 2012 e 2016',
    xaxis = list(title = 'Mês'),
    yaxis = list(title = 'Valor mediano', fixedrange = TRUE),
    legend = list(x = 100, y = 0.5)
  )
```

### 2.16 - Geralmente, quantas propostas são recebidas para licitações de merenda?

```{r}
plot_ly(data = licitacoes_merenda, x = ~nu_Propostas) %>%
  add_histogram() %>%
  layout(title = 'Total de propostas para licitações de merenda',
         yaxis = list(title = 'Total', zeroline = FALSE, fixedrange = TRUE),
         xaxis = list(title = 'Número de propostas', zeroline = FALSE))
```

É possível perceber que em geral as licitações recebem poucas prospostas, na verdade, `r round(nrow(filter(licitacoes_merenda, nu_Propostas <= 3))/nrow(licitacoes_merenda) * 100, 2)`% das licitações tem até 3 propostas.  
Mas existem alguns casos onde o número de fornecedores interessados na licitação é muito maior, chegando até a `r max(licitacoes_merenda$nu_Propostas)` em uma única licitação. Abaixo estão as 10 licitações com mais concorrentes.  
```{r}
kable(
  x = head(arrange(select(licitacoes_merenda, c(de_Municipio, nu_Propostas, valor_merenda)), desc(nu_Propostas)), 5),
  col.names = c('Município','Número de propostas', 'Valor da empenhado para merenda (R$)'),
  align = c('c'))
```

### 2.17 - O valor da licitação está relacionado com o total de propostas recebidas?
```{r}
cor1 = with(licitacoes_merenda,
            round(cor(valor_merenda, nu_Propostas), 2))

plot_ly(data = licitacoes_merenda,
        x = ~valor_merenda,
        y = ~nu_Propostas,
        alpha = 0.5,
        type = 'scatter',
        mode = 'markers',
        text = ~paste('Valor: R$', valor_merenda, 'Propostas: ', nu_Propostas),
        hoverinfo = 'text') %>%
  layout(title = 'Número de propostas por valor total de licitação',
         xaxis = list(title = 'Valor da licitação'),
         yaxis = list(title = 'Número de propostas'),
         annotations = list(x = 1e+07, y = 30, showarrow = FALSE, text = paste('r = ', cor1)))
```


```{r}
cor2 = with(filter(licitacoes_merenda,
                   vl_Licitacao <= quantile(licitacoes_merenda$valor_merenda, .99) &
                     nu_Propostas <= quantile(licitacoes_merenda$nu_Propostas, .99)),
            round(cor(valor_merenda, nu_Propostas), 2))

plot_ly(data = licitacoes_merenda %>% filter(valor_merenda <= quantile(licitacoes_merenda$valor_merenda, .99) & nu_Propostas <= quantile(licitacoes_merenda$nu_Propostas, .99)),
        x = ~valor_merenda,
        y = ~nu_Propostas,
        alpha = 0.5,
        type = 'scatter',
        mode = 'markers',
        text = ~paste('Valor: R$', valor_merenda, 'Propostas: ', nu_Propostas),
        hoverinfo = 'text') %>%
  layout(title = 'Número de propostas por valor total de licitação (99-percentil)',
         xaxis = list(title = 'Valor da licitação'),
         yaxis = list(title = 'Número de propostas'),
         annotations = list(x = 1e+06, y = 6, showarrow = FALSE, text = paste('r = ', cor2)))
```


### 2.18 - Qual a relação entre o total de licitações de merenda e o número de propostas por modalidade?
```{r}

plot_ly(data = licitacoes_merenda,
        x = ~nu_Propostas,
        color = ~as.factor(de_TipoLicitacao)) %>%
  add_histogram() %>%
  layout(title = 'Total de propostas recebidas por licitações de cada modalidade',
         xaxis = list(title = 'Número de propostas',
                      autotick = FALSE,
                      range = list(0, 6),
                      dtick = 1),
         yaxis = list(title = 'Total de licitações'),
         legend = list(x = 100, y = 0.5))
```




### 2.13 - Que modalidade de licitação é mais comum na compra de merenda?
### 2.14 - O valor médio da licitação alterou ao longo dos anos com relação às modalidades de licitação?
### 2.15 - A popularidade de alguma modalidade de licitação mudou ao longo dos anos?


